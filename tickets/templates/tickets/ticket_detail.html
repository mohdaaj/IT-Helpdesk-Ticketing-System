{% extends 'tickets/base.html' %}

{% block content %}
<h2>{{ ticket.title }}</h2>

<p>Status: {{ ticket.status }}</p>
<p>Priority: <strong>{{ ticket.get_priority_display }}</strong></p>
<p>Created: {{ ticket.created_at|date:"Y-m-d H:i" }}</p>
<p>{{ ticket.description }}</p>
{% if user.role == 'helper' %}
  <div class="staff-details">
    <h4>Staff Details</h4>
    <ul>
      <li>Username: {{ ticket.created_by.username }}</li>
      <li>Email: {{ ticket.created_by.email }}</li>
      <li>Gender: {{ ticket.created_by.gender|capfirst }}</li>
      <li>Birth Date: {{ ticket.created_by.birth_date }}</li>
    </ul>
  </div>
{% endif %}

{# Display helper justification if ticket is closed #}
{% if ticket.status == 'closed' and ticket.justification %}
  <div class="ticket-justification">
    <strong>Helper's Justification:</strong>
    <p>{{ ticket.justification }}</p>
  </div>
{% endif %}

{# Display rating if ticket is closed #}
{% if ticket.status == 'closed' %}
  {% if ticket.rating %}
    <div class="ticket-rating">
      <strong>Your Rating:</strong> {{ ticket.rating }} / 5
    </div>
  {% elif user == ticket.created_by %}
    <form method="post" action="">
      {% csrf_token %}
      <label for="rating">Rate the helper (1-5):</label>
      <input type="number" name="rating" id="rating" min="1" max="5" required>
      <button type="submit">Submit Rating</button>
    </form>
  {% endif %}
{% endif %}

{# Action links depending on user role #}
{% if user.role == 'staff' and ticket.created_by == user %}
  <a href="{% url 'tickets:ticket_update' ticket.pk %}">Edit</a> |
  <a href="{% url 'tickets:ticket_delete' ticket.pk %}">Delete</a> |
{% elif user.role == 'helper' %}
  <a href="{% url 'tickets:ticket_update' ticket.pk %}">Close/Justify</a> |
{% endif %}
<a href="{% url 'tickets:ticket_list' %}">Back to List</a>


{% endblock %}
